<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Logical Simulator</title>
    <style>
        :root {
            /* Same Cyberpunk Theme for Consistency */
            --bg-dark: #050505;
            --bg-panel: #0f1115;
            --border: #27272a;
            --neon-blue: #00f3ff;
            --neon-green: #00ff9d;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --text-main: #e0e6ed;
            --text-muted: #8b9bb4;
            --font-code: 'Consolas', monospace;
            --font-ui: 'Inter', sans-serif;
        }

        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg-dark); color: var(--text-main); font-family: var(--font-ui); height: 100vh; display: flex; flex-direction: column; overflow: hidden; user-select: none; }

        header { height: 60px; background: rgba(15,17,21,0.9); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; }
        .brand { font-size: 1.2rem; font-weight: 800; color: var(--neon-green); letter-spacing: 1px; display: flex; gap: 15px; align-items: center; }
        
        .home-btn { text-decoration: none; color: var(--text-muted); font-size: 0.9rem; font-weight: 600; border: 1px solid var(--border); padding: 6px 12px; border-radius: 4px; transition: 0.3s; display: flex; gap: 5px; }
        .home-btn:hover { border-color: var(--neon-blue); color: var(--neon-blue); background: rgba(0,243,255,0.1); }

        .grid-container { display: grid; grid-template-columns: 280px 1fr 400px; flex: 1; height: calc(100vh - 60px); }
        .panel { border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--bg-dark); }
        .panel-header { padding: 12px; background: var(--bg-panel); border-bottom: 1px solid var(--border); font-size: 0.75rem; font-weight: bold; color: var(--text-muted); text-transform: uppercase; }

        /* CONTROLS */
        .controls { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        select { width: 100%; background: var(--bg-panel); color: white; border: 1px solid var(--border); padding: 10px; cursor: pointer; }
        .btn-run { width: 100%; padding: 12px; background: var(--neon-green); color: black; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .btn-run:disabled { opacity: 0.5; cursor: not-allowed; }
        .log { flex: 1; background: #000; border: 1px solid var(--border); padding: 10px; font-family: var(--font-code); font-size: 0.8rem; overflow-y: auto; color: var(--text-muted); }
        
        /* CODE */
        .sql-area { flex: 1; background: #080a0c; padding: 30px; font-family: var(--font-code); font-size: 1.1rem; line-height: 2; }
        .sql-line { padding: 5px 10px; border-radius: 4px; transition: 0.3s; border-left: 3px solid transparent; opacity: 0.5; }
        .active-step { opacity: 1; background: rgba(0, 255, 157, 0.1); border-left-color: var(--neon-green); transform: translateX(10px); color: white; }
        .keyword { color: var(--neon-purple); font-weight: bold; }

        /* VISUAL STAGE */
        .stage { flex: 1; background: radial-gradient(circle at center, #111 0%, #050505 100%); padding: 30px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        
        .data-table { border-collapse: collapse; min-width: 300px; background: var(--bg-panel); border: 1px solid var(--border); font-size: 0.85rem; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .data-table th { background: #1a1e26; color: var(--neon-green); padding: 10px; text-align: left; }
        .data-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); color: var(--text-main); transition: 0.3s; }
        
        .filtered-out { opacity: 0.2; text-decoration: line-through; color: var(--neon-red); }
        .kept { background: rgba(0, 255, 157, 0.1); }

    </style>
</head>
<body oncontextmenu="return false;">

    <header>
        <div class="brand">
            <a href="index.html" class="home-btn">üè† Home</a>
            <span>SQL LOGIC SIMULATOR</span>
        </div>
        <a href="#" onclick="alert('Step through SQL to see logical execution order.')" class="home-btn">Help ?</a>
    </header>

    <div class="grid-container">
        <!-- LEFT -->
        <div class="panel">
            <div class="panel-header">Controls</div>
            <div class="controls">
                <select id="simSelect" onchange="initSim()">
                    <option value="where">1. WHERE Filter</option>
                    <option value="join">2. Inner Join</option>
                    <option value="group">3. Group By</option>
                </select>
                <button id="nextBtn" class="btn-run" onclick="nextStep()">‚ñ∂ Next Step</button>
                <div class="log" id="logger">Ready.</div>
            </div>
        </div>

        <!-- CENTER -->
        <div class="panel">
            <div class="panel-header">SQL Code (Execution Order Highlight)</div>
            <div class="sql-area" id="codeEditor"></div>
        </div>

        <!-- RIGHT -->
        <div class="panel">
            <div class="panel-header">Data Stage</div>
            <div class="stage" id="stage"></div>
        </div>
    </div>

    <script>
        // Security
        document.onkeydown = function(e) { if(e.keyCode == 123 || (e.ctrlKey && e.keyCode == 85)) return false; }

        const scenarios = {
            where: {
                lines: [
                    { id: "sel", text: "SELECT name, role" },
                    { id: "frm", text: "FROM employees" },
                    { id: "whr", text: "WHERE salary > 50k" }
                ],
                steps: [
                    { line: "frm", msg: "1. FROM: Load Table", action: "load" },
                    { line: "whr", msg: "2. WHERE: Filter Rows", action: "filter" },
                    { line: "sel", msg: "3. SELECT: Pick Columns", action: "select" }
                ],
                data: [
                    {name: "Alice", role: "Dev", salary: 60000},
                    {name: "Bob", role: "Design", salary: 45000},
                    {name: "Charlie", role: "Lead", salary: 70000}
                ]
            },
            join: {
                lines: [
                    { id: "sel", text: "SELECT e.name, d.dept" },
                    { id: "frm", text: "FROM employees e" },
                    { id: "join", text: "JOIN depts d ON e.did = d.id" }
                ],
                steps: [
                    { line: "frm", msg: "1. FROM: Load Left Table", action: "load_left" },
                    { line: "join", msg: "2. JOIN: Match Keys", action: "show_join" },
                    { line: "sel", msg: "3. SELECT: Combine Columns", action: "show_result" }
                ]
            },
            group: {
                lines: [
                    { id: "sel", text: "SELECT dept, COUNT(*)" },
                    { id: "frm", text: "FROM employees" },
                    { id: "grp", text: "GROUP BY dept" }
                ],
                steps: [
                    { line: "frm", msg: "1. FROM: Load Data", action: "load_group" },
                    { line: "grp", msg: "2. GROUP BY: Bucket Rows", action: "bucket" },
                    { line: "sel", msg: "3. SELECT: Aggregate", action: "agg" }
                ]
            }
        };

        let currentKey = 'where', stepIdx = 0;

        function initSim() {
            currentKey = document.getElementById('simSelect').value;
            stepIdx = 0;
            document.getElementById('logger').innerText = "Ready.";
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').innerText = "‚ñ∂ Next Step";
            document.getElementById('stage').innerHTML = '<div style="color:#555; margin-top:50px;">Waiting...</div>';
            
            const editor = document.getElementById('codeEditor');
            editor.innerHTML = '';
            scenarios[currentKey].lines.forEach(l => {
                editor.innerHTML += `<div class="sql-line" id="${l.id}">${l.text.replace(/([A-Z]+)/g, '<span class="keyword">$1</span>')}</div>`;
            });
        }

        function nextStep() {
            const s = scenarios[currentKey].steps;
            if(stepIdx >= s.length) return;
            
            const step = s[stepIdx];
            document.getElementById('logger').innerHTML += `<div>> ${step.msg}</div>`;
            
            document.querySelectorAll('.sql-line').forEach(el => el.classList.remove('active-step'));
            document.getElementById(step.line).classList.add('active-step');

            runVisual(step.action);

            stepIdx++;
            if(stepIdx >= s.length) {
                document.getElementById('nextBtn').innerText = "Done";
                document.getElementById('nextBtn').disabled = true;
            }
        }

        function runVisual(act) {
            const stage = document.getElementById('stage');
            const data = scenarios.where.data;

            if(act === 'load') {
                stage.innerHTML = makeTable(data, ['name','role','salary']);
            } else if(act === 'filter') {
                const rows = stage.querySelectorAll('tbody tr');
                rows[1].classList.add('filtered-out'); // Bob
                rows[0].classList.add('kept');
                rows[2].classList.add('kept');
            } else if(act === 'select') {
                stage.innerHTML = makeTable([{name:"Alice", role:"Dev"}, {name:"Charlie", role:"Lead"}], ['name','role']);
            } 
            
            // Join Logic
            else if(act === 'load_left') {
                stage.innerHTML = makeTable([{id:1, name:"Alice", did:101}, {id:2, name:"Bob", did:102}], ['id','name','did']);
            } else if(act === 'show_join') {
                stage.innerHTML += `<div style="font-size:2rem; color:var(--neon-blue);">+</div>`;
                stage.innerHTML += makeTable([{id:101, dept:"Eng"}, {id:102, dept:"HR"}], ['id','dept']);
            } else if(act === 'show_result') {
                stage.innerHTML = makeTable([{name:"Alice", dept:"Eng"}, {name:"Bob", dept:"HR"}], ['name','dept']);
            }

            // Group Logic
            else if(act === 'load_group') {
                stage.innerHTML = makeTable([{name:"A", dept:"IT"}, {name:"B", dept:"IT"}, {name:"C", dept:"HR"}], ['name','dept']);
            } else if(act === 'bucket') {
                stage.innerHTML = `
                    <div style="border:1px dashed #555; padding:10px; width:100%;">
                        <strong style="color:var(--neon-green)">IT Bucket</strong>
                        <div>{name: A}, {name: B}</div>
                    </div>
                    <div style="border:1px dashed #555; padding:10px; width:100%;">
                        <strong style="color:var(--neon-green)">HR Bucket</strong>
                        <div>{name: C}</div>
                    </div>
                `;
            } else if(act === 'agg') {
                stage.innerHTML = makeTable([{dept:"IT", count:2}, {dept:"HR", count:1}], ['dept','count']);
            }
        }

        function makeTable(rows, keys) {
            let h = `<table class="data-table"><thead><tr>${keys.map(k=>`<th>${k}</th>`).join('')}</tr></thead><tbody>`;
            rows.forEach(r => {
                h += `<tr>${keys.map(k=>`<td>${r[k]}</td>`).join('')}</tr>`;
            });
            return h + `</tbody></table>`;
        }

        initSim();
    </script>
</body>
</html>